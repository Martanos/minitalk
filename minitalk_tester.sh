#!/bin/bash

# Function to send a message to the server and measure the response time
send_message() {
    message="$1"
    start_time=$(date +%s.%N)

    # Run the client with Valgrind
    valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes --log-file=valgrind.log ./client $server_pid "$message" 2>&1 >/dev/null

    end_time=$(date +%s.%N)
    response_time=$(echo "$end_time - $start_time" | bc)

    echo "Message: $message"
    echo "Response time: $response_time seconds"

    # Print the leak summary from Valgrind's output
    echo "Memory Leak Summary:"
    grep -E '(definitely|indirectly|possibly) lost:' valgrind.log

    echo "------------------------"
}

# Prompt the user to enter the server PID
read -p "Enter the server PID: " server_pid

echo "Mandatory Tests:"
echo "------------------------"

# Test case 1: ASCII characters
echo "Test case 1: ASCII characters:"
echo "------------------------"
ascii_chars=$(printf "%b" "$(printf '\\%03o' {32..126})")
send_message "$ascii_chars"

# Test case 2: Performance benchmark
echo "Test case 2: Performance benchmark:"
echo "------------------------"
echo "100 chars:"
send_message "$(perl -e 'print "A" x 100')"
echo "1000 chars:"
send_message "$(perl -e 'print "A" x 1000')"
echo "10000 chars:"
send_message "$(perl -e 'print "A" x 10000')"

# Test case 3: Multiple clients (sequential)
echo "Test case 3: Multiple clients (sequential):"
for i in {1..5}; do
    send_message "Message from client $i"
done

echo "Bonus Tests:"
echo "------------------------"

# Test case 4: Unicode support
echo "Test case 4: Unicode support:"
send_message "Ğ¢ĞµÑÑ‚ Ğ½Ğ° ĞºĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ğµ"
send_message "æµ‹è¯•ä¸­æ–‡å­—ç¬¦"
send_message "ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£"

echo "Additional Test:"
echo "------------------------"

# Test case 5: Bee Movie script and Unicode art
echo "Test case 5: Bee Movie script and Unicode art"
send_message "According to all knownğŸ§  lawsğŸ‘¨â€âš–ï¸ğŸ‘©â€âš–ï¸ of aviationğŸ§, there is noğŸ˜§ğŸ¤• way a beeğŸğŸ…±ï¸ should be able to flyğŸ›«."
send_message "Its wings are too smallğŸ†ğŸ˜® to get its fatğŸ‘ little bodyğŸ˜ off the groundğŸŒ±."
send_message "The beeğŸğŸ…±ï¸, of courseğŸ˜’, fliesğŸ›« anyway because beesğŸğŸ…±ï¸don't careğŸ˜ what humansğŸš¶â€â™‚ï¸ think is impossibleğŸ˜‰."
send_message "YellowğŸ’›, blackğŸ–¤ğŸ˜."
send_message "YellowğŸ’›, blackğŸ–¤ğŸ¤¨."
send_message "YellowğŸ’›, blackğŸ–¤ğŸ˜ ."
send_message "YellowğŸ’›, blackğŸ–¤ğŸ˜¡ğŸ¤¬ğŸ–•."
send_message "OohğŸ˜¸ğŸ¥´ğŸ˜, blackğŸ–¤ğŸ‘€ and yellowğŸ’›ğŸ¤©!"
send_message "Let's shakeğŸ§‚ it up a littleğŸ˜ğŸ‘Œ."
send_message "Barry!"
send_message "BreakfastğŸ¥ is readyğŸ˜ƒ!"
send_message "ComingğŸ˜ˆğŸ’¦!"
send_message "HangğŸ§—â€â™‚ï¸ on a secondâŒšï¸ğŸ‘€."
send_message "HelloğŸ˜ƒ?"
send_message "- BarryğŸ¤ ?"
send_message "- AdamğŸ¤ ?"
send_message "- Can you believe this is happeningğŸ˜±?"
send_message "- I can'tğŸ˜¸."
send_message "I'll pick you upğŸ˜ğŸš˜."
send_message "Looking sharpğŸ˜ğŸ‘Œ."
send_message "Use the stairsğŸ˜‘."
send_message "Your fatherğŸ§” paid good moneyğŸ’¸ğŸ’° for thoseğŸ¤¨."
send_message "SorryğŸ¥º."
send_message "I'm excitedğŸ˜."
send_message "Here's the graduateğŸ‘¨â€ğŸ“ ."
send_message "We're very proud of you, sonğŸ˜â˜ºï¸."
send_message "A perfect report cardğŸ“, all B'sğŸ…±ï¸ğŸ«ğŸ‘ŒğŸ˜º."
send_message "Very proudâ˜ºï¸ğŸ˜š."
send_message "Ma!"
send_message "I got a thing going hereğŸ˜•."
send_message "- You got lint on your fuzzğŸ¤¨."
send_message "- Ow!"
send_message "That's meğŸ˜£!"
send_message "- Wave to usğŸ˜ƒ!"
send_message "We'll be inğŸ‘‰ğŸ‘Œ row 118,000ğŸ˜."
send_message "- ByeğŸ‘‹ğŸ™‚!"
send_message "Barry, I told you, stop flying in the houseğŸ˜ !"
send_message "- Hey, AdamğŸ¤ ."
send_message "- Hey, BarryğŸ¤ ."
send_message "- Is that fuzz gelğŸ¤”?"
send_message "- A littleğŸ‘Œ."
send_message "Special day, graduationğŸ¥³ğŸ‘¨â€ğŸ“ğŸ‰."
send_message "Never thought I'd make itğŸ˜¸."
send_message "Three days grade schoolğŸ‘¦ğŸ§’ğŸ«, three days high schoolğŸ˜ˆğŸ«."
send_message "Those were awkwardğŸ˜³."
send_message "Three days collegeğŸ˜´ğŸ«."
send_message "I'm glad I took a dayğŸ“… and hitchhikedğŸƒâ€â™‚ï¸around the hiveğŸ˜‰."
send_message "You did come back differentğŸ¤”."
send_message "- Hi, BarryğŸ¤ ."
send_message "- Artie, growing a mustacheğŸ§?"
send_message "Looks goodğŸ˜„."
send_message "- Hear about FrankieğŸ¤¨?"
send_message "- YeahğŸ˜€."
send_message "- You going to the funeralğŸ˜”?"
send_message "- No, I'm not goingğŸ˜‚ğŸ¤£."
send_message "Everybody knowsğŸ§ , sting someone, you dieğŸ’€ğŸ˜’."
send_message "Don't waste it on a squirrelğŸ™„ğŸ¿."
send_message "Such a hotheadğŸ˜‘."
send_message "I guess he could have just gotten out of the wayğŸ¥µ."
send_message "I love this incorporating an amusement parkğŸ† into our dayğŸ˜ğŸ˜™."
send_message "That's why we don't need vacationsğŸ–ğŸ¤“."
send_message "Boy, quite a bit of pompğŸ˜¼... under the circumstancesğŸ˜œğŸ˜‚ğŸ¤£."
send_message "- Well, Adam, today we are menğŸ’ªğŸ˜ğŸ†."
send_message "- We areğŸ˜„!"
send_message "- Bee-menâ˜ºï¸ğŸ."
send_message "- AmenğŸ™ğŸ˜Š!"
send_message "Hallelujahâ›ªï¸ğŸ™ğŸ˜ğŸ¤ª!"
send_message "StudentsğŸ‘¨â€ğŸ“, faculty, distinguished beesğŸğŸ…±ï¸ğŸ‘€, please welcome Dean Buzzwell."
send_message "Welcome, New Hive CityğŸŒƒ graduating class of..."
send_message "...9:15âŒšï¸ğŸ‘€."
send_message "That concludes our ceremoniesğŸ¤—."
send_message "And begins your career at Honex IndustriesğŸ¯ğŸ¥³ğŸ‰!"
send_message "Will we pick our jobğŸ§°ğŸ˜´ todayğŸ¤”?"
send_message "I heard it's just orientationğŸ˜."
send_message "Heads upğŸ™‚!"
send_message "Here we goğŸ˜ƒ."
send_message "Keep your handsâœ‹ and antennasğŸ“ insideğŸ¤£ğŸ¤ª the tramğŸ‘„ğŸ’‹ğŸ˜ğŸ¥´ğŸ˜© at all timesğŸ˜œ."
send_message "- Wonder what it'll be likeğŸ§?"
send_message "- A little scaryğŸ‘»ğŸ˜–."
send_message "Welcome to HonexğŸ¯, a division of Honesco and a part of the Hexagon GroupğŸ˜ğŸ˜œğŸ¤£."
send_message "This is itğŸ˜ƒ!"
send_message "WowğŸ™‚."
send_message "WowğŸ™ƒ."
send_message "We know that you, as a beeğŸğŸ…±ï¸, have worked your whole lifeâ˜ ï¸ğŸ˜± to get to the point where you can work for your whole lifeâ˜ ï¸ğŸ‘»ğŸ’€."
send_message "HoneyğŸ¯ begins when our valiant Pollen JocksğŸ‘€ğŸ‘…ğŸ†ğŸ˜ğŸ˜ğŸ¥´ bring the nectar to the hive."
send_message "Our top-secret formulağŸ”’ğŸš«ğŸ§ is automatically color-correctedğŸŒˆ, scent-adjustedğŸ‘ƒand bubble-contouredâ­•ï¸ğŸ’‹ğŸ˜ğŸ¥´into this soothing sweet syrupğŸ‘ğŸ‘„ğŸ‘ğŸ¤¤ with its distinctive golden glowğŸ’›ğŸ˜‹ğŸ…±ï¸ you knowğŸ§  as..."
send_message "HoneyğŸ¯ğŸ˜ƒğŸ¤©ğŸ˜œ!"
send_message "- That girlğŸ§‘ was hotğŸ”¥ğŸ¥´ğŸ˜ğŸ˜ˆğŸ‘ğŸ’¦."
send_message "- She's my cousinğŸ˜¨!"
send_message "- She isğŸ˜±?"
send_message "- Yes, we're all cousinsğŸ˜¤."
send_message "- Rightâœ…."
send_message "You're rightâœ…."
send_message "- At HonexğŸ¯, we constantly strive to improve every aspect of bee existenceâ˜ ï¸ğŸ‘ŒğŸ."
send_message "These bees are stress-testing a new helmetâ›‘ technologyğŸ‘¨â€ğŸ’»ğŸ‘©â€ğŸ’»ğŸ˜€."
send_message "- What do you think he makesğŸ’µğŸ¤”?"
send_message "- Not enoughğŸ¤•ğŸ˜”."
send_message "Here we have our latest advancementâŒšï¸ğŸ†, the KrelmanğŸ˜."
send_message "- What does that doğŸ§?"
send_message "- Catches that little strand of honeyğŸ¯ that hangs after you pour itğŸ™‚."
send_message "Saves us millionsğŸ˜."
send_message "Can anyone work on the KrelmanğŸ™‹â€â™‚ï¸ğŸ¤”?"
send_message "Of courseğŸ¤—."
send_message "Most bee jobsğŸ§°ğŸ˜´ are smallğŸ‘ŒğŸ† ones."
send_message "But bees know that every smallğŸ‘ŒğŸ† jobğŸ§°ğŸ˜´, if it's done well, means a lotğŸ˜ƒ."
send_message "But choose carefullyğŸ§ because you'll stay inğŸ‘‰ğŸ‘Œ the jobğŸ§°ğŸ˜´ you pick for the rest of your lifeğŸ¤ªğŸ¥³ğŸ’€."
send_message "The same jobğŸ§°ğŸ˜´ the rest of your lifeğŸ˜°?"
send_message "I didn't knowğŸ§  thatğŸ˜“."
send_message "What's the differenceğŸ¤ª?"
send_message "You'll be happy to knowğŸ§  that beesğŸ, as a species, haven't had one day off in 27 million yearsâŒšï¸."
send_message "So you'll just work us to deathâ˜ ï¸?"
send_message "We'll sure tryğŸ˜‰."
send_message "WowğŸ¤ª!"
send_message "That blew my mindğŸ¤¯!"
send_message "What's the difference?"
send_message "How can you say thatğŸ˜¤?"
send_message "One jobğŸ§°ğŸ˜´ foreverğŸ¤¨?"
send_message "That's an insane choice to have to makeğŸ˜”."
send_message "I'm relievedğŸ™‚."
send_message "Now we only have to make one decision inğŸ‘‰ğŸ‘Œ lifeğŸ˜œ."
send_message "But, AdamğŸ˜•, how could they never have told us thatğŸ˜ ?"
send_message "Why would you question anything?"
send_message "We're beesğŸğŸ…±ï¸."
send_message "We're the most perfectly functioning society on EarthğŸŒ."
send_message "You ever think maybe things work a little too well hereğŸ¤”?"
send_message "Like whatğŸ¤¨?"
send_message "Give me one exampleğŸ˜¤."
send_message "I don't knowğŸ˜¯."
send_message "But you know what I'm talking aboutğŸ˜¤."
send_message "Please clear the gate."
send_message "Royal Nectar Forceâš”ï¸ğŸ›¡ on approach."
send_message "Wait a secondâŒšï¸."
send_message "Check it outğŸ˜¯."
send_message "- Hey, those are Pollen JocksğŸ‘€ğŸ¥´!"
send_message "- Wow."
send_message "I've never seen them this closeğŸ˜œ."
send_message "They know what it's like outside the hiveâ˜ºï¸."
send_message "Yeah, but some don't come backğŸ˜¥."
send_message "- Hey, JocksğŸ§‘ğŸ˜ğŸ˜ğŸ‘ğŸ¥³ğŸ˜©ğŸ¤¤ğŸ¥´ğŸ”!"
send_message "- Hi, JocksğŸ§‘ğŸ˜ğŸ˜ğŸ‘ğŸ¥³ğŸ˜©ğŸ¤¤ğŸ¥´ğŸ”!"
send_message "You guys did greatğŸ‘¨â€ğŸ¦³ğŸ˜ƒ!"
send_message "You're monstersğŸ˜ˆ!"
send_message "You're sky freaksğŸ!"
send_message "I love itğŸ˜œ!"
send_message "I love itğŸ˜!"
send_message "- I wonder where they wereğŸ¤”ğŸ§ğŸ¤“."
send_message "- I don't knowğŸ˜¯."
send_message "Their day'sğŸ“… notğŸ¤•ğŸš« planned."
send_message "Outside the hive, flying who knows where, doing who knows whatğŸ¤”."
send_message "You can't just decide to be a Pollen JockğŸ’ªğŸ˜»ğŸ†."
send_message "You have to be bred for thatğŸ˜."
send_message "Rightâœ…."
send_message "LookğŸ‘€."
send_message "That's more pollen than you and I will see inğŸ‘‰ğŸ‘Œ a lifetimeâ˜ ï¸ğŸ‘»."
send_message "It's just a status symbolğŸ˜’."
send_message "BeesğŸğŸ…±ï¸ make too much of it."
send_message "PerhapsğŸ¤ª."
send_message "Unless you're wearing itğŸ˜ and the ladiesğŸ§‘ see you wearing itğŸ‘€ğŸ‘„ğŸ’‹ğŸ‘ğŸ˜ğŸ¥´ğŸ‘‰ğŸ‘ŒThose ladies?"
send_message "Aren't they our cousins tooğŸ™?"
send_message "DistantğŸ™‚."
send_message "DistantğŸ™ƒ."
send_message "Look at these twoğŸ˜."
send_message "- Couple of Hive HarrysğŸ¤“ğŸ˜‚."
send_message "- Let's have fun with themğŸ˜ˆ."
send_message "It must be dangerousğŸš« being a Pollen JockğŸ’ªğŸ†."
send_message "YeahğŸ˜."
send_message "Once a bearğŸ»ğŸ‘… pinned meğŸ”ğŸ¥´ğŸ˜ğŸ˜˜ğŸ˜œ against a mushroomğŸ„!"
send_message "He had a paw on my throatğŸ˜©ğŸ˜œğŸ˜, and with the other, he was slapping meğŸ‘ŒğŸ†ğŸ˜©ğŸ¥°ğŸ˜šğŸ¤ª!"
send_message "- Oh, my!"
send_message "- I never thought I'd knock him outğŸ˜©ğŸ‘‰ğŸ‘ŒğŸ†ğŸ‘ğŸ“ğŸ˜šğŸ˜."
send_message "What were you doing during thisğŸ§?"
send_message "Trying to alert the authoritiesğŸ˜ğŸ˜©ğŸ¥´ğŸ”¥ğŸ‘."
send_message "I can autographğŸ“ thatğŸ¥´ğŸ˜©ğŸ˜."
send_message "A little gustyğŸŒ¬ out there today, wasn't it, comradesğŸ˜?"
send_message "Yeah."
send_message "GustyğŸŒ¬."
send_message "We're hitting a sunflowerğŸŒ» patch six miles from here tomorrowğŸ˜."
send_message "- Six miles, huhğŸ˜¯?"
send_message "- BarryğŸ¤¨!"
send_message "A puddleğŸ’§ jumpğŸ¤¾â€â™‚ï¸ for us, but maybe you're not up for itğŸ˜."
send_message "- Maybe I amğŸ˜."
send_message "- You are notğŸ˜ !"
send_message "We're going 0900 at J-GateğŸ‘¿."
send_message "What do you think, buzzy-boyğŸ?"
send_message "Are you bee enoughğŸ†ğŸ˜ˆğŸ¥´ğŸ“ğŸ‘€ğŸ‘…ğŸ˜ğŸ˜ğŸ‘‰ğŸ‘Œ?"
send_message "I might beğŸ˜ğŸ¥´."
send_message "It all depends on what 0900 meansğŸ˜ğŸ˜©ğŸ†ğŸ¥´ğŸ‘‰ğŸ‘Œ."
send_message "Hey, HonexğŸ¤ !"
send_message "DadğŸ˜±, you surprised meğŸ˜¨."
send_message "You decide what you're interested inğŸ¤ ?"
send_message "- Well, there's a lot of choicesğŸ˜“."
send_message "- But you only get oneğŸ˜°."
send_message "Do you ever get boredğŸ˜´ doing the same jobğŸ§°ğŸ˜´ every dayğŸ“…ğŸ¤”?"
send_message "Son, let me tell you about stirringğŸ˜ƒ."
send_message "You grab that stick, and you just move it around, and you stir it aroundğŸ˜„."
send_message "You get yourself into a rhythmğŸµğŸ¶."
send_message "It's a beautiful thingğŸ˜»."
send_message "You know, Dad, the more I think about it, maybe the honeyğŸ¯ field just isn't right for meğŸ˜”."
send_message "You were thinking of what, making balloon animalsğŸ˜’?"
send_message "That's a bad jobğŸ§°ğŸ˜´ for a guy with a stingerğŸ˜œ."
send_message "JanetğŸ‘©â€ğŸ¦±, your son's not sure he wants to go into honeyğŸ¯!"
send_message "- Barry, you are so funnyğŸ˜‚ sometimesğŸ˜‚ğŸ˜‚ğŸ˜‚."
send_message "- I'm not trying to be funnyğŸ˜ ."
send_message "You're not funnyâ˜¹ï¸!"
send_message "You're going into honeyğŸ‘„ğŸ¯."
send_message "Our son, the stirrerğŸ˜†!"
send_message "- You're gonna be a stirrerğŸ˜ƒ?"
send_message "- No one's listening to meğŸ˜ !"
send_message "Wait till you see the sticks I haveğŸ˜"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"
send_message "ğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸğŸ"